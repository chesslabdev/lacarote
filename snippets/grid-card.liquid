{% assign h_align = block.settings.text_alignment | default: 'center' %}
{% assign v_align = block.settings.vertical_alignment | default: 'middle' %}
{% assign position_classes = v_align | append: ' ' | append: h_align %}

{% assign card_clickable = block.settings.enable_card_link | default: false %}
{% assign card_url = block.settings.card_link | default: block.settings.button_link %}

{% assign effective_button_href = block.settings.button_link | default: card_url %}

<div class="grid-card grid-card--{{ index }} {% if modifier %}grid-card--{{ modifier }}{% endif %} {% if card_clickable and card_url != blank %}grid-card--clickable{% endif %}" 
     data-card-index="{{ index }}">

  {%- if card_clickable and card_url != blank -%}
    <a href="{{ card_url }}" class="grid-card__link-wrapper" aria-label="{{ block.settings.heading | default: 'Link do Card' | escape }}">
  {%- endif -%}

  {%- if block.settings.image -%}
    {{ block.settings.image | image_url: width: 1920 | image_tag:
      loading: 'lazy',
      class: 'grid-card__image',
      alt: block.settings.heading | escape
    }}
  {%- else -%}
    {{ 'lifestyle-' | append: index | placeholder_svg_tag: 'grid-card__image placeholder-svg' }}
  {%- endif -%}

  <div class="grid-card__overlay"></div>

  <div class="grid-card__content content-position--{{ position_classes }} text-align--{{ h_align }}">
    {%- if block.settings.enable_heading and block.settings.heading != blank -%}
      <h2 class="grid-card__heading {% unless section.settings.heading_underline %}no-underline{% endunless %}">
        {{ block.settings.heading }}
      </h2>
    {%- endif -%}

    {%- if block.settings.enable_button and block.settings.button_text != blank -%}
      {%- if card_clickable and card_url != blank -%}
        <span class="grid-card__button button button--primary" role="link" aria-label="{{ block.settings.button_text }} - {{ block.settings.heading | escape }}">
          {{ block.settings.button_text }}
        </span>
      {%- else -%}
        {%- if effective_button_href != blank -%}
          <a href="{{ effective_button_href }}"
             class="grid-card__button button button--primary"
             aria-label="{{ block.settings.button_text }}{% if block.settings.heading != blank %} - {{ block.settings.heading | escape }}{% endif %}">
            {{ block.settings.button_text }}
          </a>
        {%- else -%}
          <span class="grid-card__button button button--primary is-disabled" aria-disabled="true">
            {{ block.settings.button_text }}
          </span>
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
  </div>

  {%- if card_clickable and card_url != blank -%}
    </a>
  {%- endif -%}

  <div class="visually-hidden">Card {{ index }} de {{ section.blocks.size }}</div>
</div>